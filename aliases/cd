# cd alias add the branch name to prompt
# PROMPT is a special variable used by nash command line to
# setup your prompt.
PROMPTSYM = "Î»> "
DEFPROMPT = $NASH_RED+$PROMPTSYM+$NASH_RESET
PROMPT = $DEFPROMPT
setenv PROMPT

fn getDir() {
        currentdir <= pwd
        dirname <= basename $currentdir | tr -d "\n"
        return $dirname
}

fn refreshPrompt() {
        dirname <= getDir()
        PROMPT = "(" + $dirname + ")" + $DEFPROMPT
	-test -d ./.git
	if $status == "0" {
                IFS = ""
		branch <= git rev-parse --abbrev-ref HEAD | xargs echo -n
		PROMPT = "(" + $dirname + "(git("+$NASH_GREEN+$branch+$NASH_RESET+")))"+$DEFPROMPT
	}

	setenv PROMPT
}

# cd overrides built-in cd
# Add the current branch before prompt (if current directory is a git repo)
fn cd(path) {
	if $path == "" {
		path = $HOME
	} else if $path == "~" {
		path = $HOME
	}

        chdir($path)
	refreshPrompt()
}

bindfn cd cd
