# prompt

# PROMPT is a special variable used by nash command line to
# setup your prompt.
PROMPTSYM = "Î»> "
DEFPROMPT = $NASH_RED+$PROMPTSYM+$NASH_RESET
PROMPT    = $DEFPROMPT

setenv PROMPT

fn updatePrompt() {
	PROMPT = $DEFPROMPT
	IFS    = ""

	-test -d ./.git

	if $status == "0" {
		branch <= -git rev-parse --abbrev-ref HEAD >[2=]

		if $status == "0" {
			# workaround nash issue #96
			branch <= echo -n $branch | xargs echo -n

			PROMPT = $NASH_GREEN+"git:("+$branch+$NASH_RESET+")"+$DEFPROMPT
		}
	} else {
		datetime <= date "+%d/%m/%Y %H:%M:%S"

		PROMPT = $NASH_GREEN+"("+$datetime+")"+$DEFPROMPT
	}

	setenv PROMPT
}

fn nash_repl_before() {
	updatePrompt()
}

fn nash_repl_after(line, status) {
	updatePrompt()
}
